#textdomain wesnoth-A_Rough_Life
[scenario]
    name= _ "The Day of Reckoning"
    id=11_The_Day_of_Reckoning
    next_scenario=12_Flip_of_Destiny
    victory_when_enemies_defeated=no

    map_data="{~add-ons/A_Rough_Life/maps/reckoning.map}"
    {INTRO_AND_SCENARIO_MUSIC loyalists.ogg battle.ogg}
    {EXTRA_SCENARIO_MUSIC vengeful.ogg}
    {EXTRA_SCENARIO_MUSIC the_city_falls.ogg}
    turns=-1

    {UNDERGROUND}

    [side]
        side=1
        controller=human
        id=Jacques
        name= _ "Fierce Jacques"
        unrenamable=yes
        type=Battle Commander
        shroud=yes
        canrecruit=yes
        recruit=Orcish Grunt,Saurian Augur,Spearman,Thug,Elvish Archer,Sergeant
        team_name=Jacques
        user_team_name= _ "Jacques"
        {GOLD 200 150 100}
        {INCOME 12 9 6}
        village_gold=1
    [/side]

    [side]
        side=2
        id=Ruphulus
        name= _ "Ruphulus"
        unrenamable=yes
        type=Dragon Lord
        profile=portraits/dragon_head.png
        canrecruit=yes
        team_name=Ruphulus
        user_team_name= _ "Ruphulus"
        gold=0
        {ai/aliases/stable_singleplayer.cfg}
        [ai]
            {AI_SIMPLE_ALWAYS_ASPECT aggression 1}
            {AI_SIMPLE_ALWAYS_ASPECT caution 0}
            {AI_SIMPLE_ALWAYS_ASPECT passive_leader yes}
        [/ai]
        [unit]
            side=2
            type=Skeleton Guardian
            id=Fear
            x,y=19,29
            name= _ "Fear"
            unrenamable=yes
            upkeep=zero
            facing=se
        [/unit]
        [unit]
            side=2
            type=Skeleton Guardian
            id=Loathing
            x,y=21,29
            name= _ "Loathing"
            unrenamable=yes
            profile=portraits/undead/transparent/skeleton.png~FL(horiz)~RIGHT()
            upkeep=zero
            facing=sw
        [/unit]
    [/side]

    [side]
        side=3
        id=Dark Knight
        name= _ "Dark Knight"
        unrenamable=yes
        type=Death Knight
        canrecruit=yes
        recruit=Deathblade,Revenant,Bone Shooter,Banebow
        team_name=Ruphulus
        user_team_name= _ "Undead"
        {GOLD 60 80 100}
        {INCOME 2 3 4}
        {ai/aliases/stable_singleplayer.cfg}
        [ai]
            {AI_SIMPLE_ALWAYS_ASPECT aggression 0.5}
            {AI_SIMPLE_ALWAYS_ASPECT caution 0}
            {AI_SIMPLE_ALWAYS_ASPECT passive_leader yes}
            {AI_SIMPLE_ALWAYS_ASPECT grouping no}
            {AI_SIMPLE_ALWAYS_ASPECT village_value 1}
            {AI_SIMPLE_ALWAYS_ASPECT leader_value 3}
        [/ai]
    [/side]

    [side]
        side=4
        id=Blood Knight
        name= _ "Blood Knight"
        unrenamable=yes
        type=Death Knight
        canrecruit=yes
        recruit=Deathblade,Revenant,Bone Shooter,Banebow
        team_name=Ruphulus
        user_team_name= _ "Undead"
        {GOLD 60 80 100}
        {INCOME 2 3 4}
        {ai/aliases/stable_singleplayer.cfg}
        [ai]
            {AI_SIMPLE_ALWAYS_ASPECT aggression 0.5}
            {AI_SIMPLE_ALWAYS_ASPECT caution 0}
            {AI_SIMPLE_ALWAYS_ASPECT passive_leader yes}
            {AI_SIMPLE_ALWAYS_ASPECT grouping no}
            {AI_SIMPLE_ALWAYS_ASPECT village_value 1}
            {AI_SIMPLE_ALWAYS_ASPECT leader_value 3}
        [/ai]
    [/side]

    [side]
        side=5
        id=Bone Marshall
        name= _ "Bone Marshall"
        unrenamable=yes
        type=Draug
        canrecruit=yes
        recruit=Skeleton,Skeleton Archer,Vampire Bat
        team_name=Ruphulus
        user_team_name= _ "Undead"
        {GOLD 90 120 150}
        {INCOME 4 6 8}
        {ai/aliases/stable_singleplayer.cfg}
        [ai]
            {AI_SIMPLE_ALWAYS_ASPECT aggression 0.5}
            {AI_SIMPLE_ALWAYS_ASPECT caution 0}
            {AI_SIMPLE_ALWAYS_ASPECT passive_leader yes}
            {AI_SIMPLE_ALWAYS_ASPECT grouping no}
            {AI_SIMPLE_ALWAYS_ASPECT village_value 1}
            {AI_SIMPLE_ALWAYS_ASPECT leader_value 3}
        [/ai]
    [/side]

    [side]
        side=6
        id=Pet of Death
        name= _ "Pet of Death"
        unrenamable=yes
        type=Skeletal Dragon
        canrecruit=yes
        recruit=Chocobone,Deathblade,Revenant,Bone Shooter,Skeleton,Skeleton Archer
        team_name=Ruphulus
        user_team_name= _ "Undead"
        {GOLD 100 140 180}
        {INCOME 5 7 9}
        {ai/aliases/stable_singleplayer.cfg}
        [ai]
            {AI_SIMPLE_ALWAYS_ASPECT aggression 0.5}
            {AI_SIMPLE_ALWAYS_ASPECT caution 0}
            {AI_SIMPLE_ALWAYS_ASPECT passive_leader yes}
            {AI_SIMPLE_ALWAYS_ASPECT grouping no}
            {AI_SIMPLE_ALWAYS_ASPECT village_value 1}
            {AI_SIMPLE_ALWAYS_ASPECT leader_value 3}
        [/ai]
    [/side]

    [side]
        side=7
        type=Ancient Lich
        id=Counsellor of Death
        name= _ "Counsellor of Death"
        unrenamable=yes
        profile="portraits/lich-servant.png"
        canrecruit=yes
        recruit=Lich,Chocobone,Deathblade,Revenant,Banebow,Skeleton,Skeleton Archer
        {GOLD 100 140 180}
        {INCOME 5 7 9}
        [ai]
            {AI_SIMPLE_ALWAYS_ASPECT aggression 0.5}
            {AI_SIMPLE_ALWAYS_ASPECT caution 0}
            {AI_SIMPLE_ALWAYS_ASPECT passive_leader yes}
            {AI_SIMPLE_ALWAYS_ASPECT grouping no}
            {AI_SIMPLE_ALWAYS_ASPECT village_value 1}
            {AI_SIMPLE_ALWAYS_ASPECT leader_value 3}
        [/ai]
        {ai/aliases/stable_singleplayer.cfg}
        team_name=Ruphulus
        user_team_name= _ "Undead"
    [/side]

    [event]
        name=prestart
        {VARIABLE Fear_and_Loathing 0}
        {VARIABLE bridges_built 0}
        {VARIABLE Krug_met no}
        {VARIABLE Bombasan_dead no} # don't clear, used in 12_
        {VARIABLE Kyoko_knows no}
        {MODIFY_UNIT id=Jacques name ( _ "Fierce Jacques")}
        [objectives]
            side=1
            [objective]
                description= _ "Defeat Ruphulus"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Jacques"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Kyoko"
                condition=lose
            [/objective]
            [gold_carryover]
                bonus=yes
                carryover_percentage=10
            [/gold_carryover]
        [/objectives]
        # wmllint: recognize Kyoko
        {RECALL_LOYALS_AND_KYOKO}
        [recall]
            id=King Bombasan
        [/recall]
        # added x,y to avoid dwarves being recalled in lava
        [recall]
            id=Semper
            x,y=19,38
        [/recall]
        [recall]
            id=Fi
            x,y=21,38
        [/recall]

        [item]
            image=scenery/oak-leaning.png
            x,y=7,37
        [/item]
        [item]
            image=items/bonestack.png
            x,y=30,12
        [/item]
        [item]
            image=items/dragonstatue.png
            x=18,22
            y=30,30
        [/item]
        [item]
            image=items/altar-evil.png
            x=1,7
            y=1,1
        [/item]
        [item]
            image=scenery/signpost.png
            x= 8,18,28
            y=28,24,21
        [/item]
        [item]
            image=items/burial.png
            x=1,1,7,7,12,14,15,16,17,18,22,24,26,31,31,32
            y=4,7,4,7,11,11, 4, 4, 5, 5, 9, 9, 3,19,20,19
        [/item]
        [item] # explorer
            image=items/bones.png
            x= 1,11,12,12,40
            y=21, 2, 1, 2,18
        [/item]
        # explorer's items
        [item]
            image=
            x,y=
        [/item]
        [item]
            image=items/abandoned-fire.png
            x,y=39,20
        [/item]
        [item]
            image=items/backpack.png
            x,y=39,18
        [/item]
        [item]
            image=items/boots.png
            x,y=38,18
        [/item]
        [item]
            image=items/parchment.png
            x,y=38,17
        [/item]
        [item]
            image=items/shovel.png
            x,y=39,17
        [/item]
        [item] # pulverized
            image=items/bones.png
            x=27,27,28,29,31,32,32
            y= 9,11,11, 8,11, 9,10
        [/item]
    [/event]

    {STORY_11_THE_DAY_OF_RECKONING}

    [event]
        name=start

        [switch]
            variable=Jacques_type
            [case] # is now T will advance to ST (set in 05_)
                value=Thief
                [message]
                    speaker=narrator
                    message= _ "Albeit he has <i>led</i> his troops to the final battle, Jacques can't look them in the eyes. He has survived thus far hiding behind their steadfast shoulders. If he does not prove himself in battle soon, his good standing may be lost."
                    image=wesnoth-icon.png
                [/message]
            [/case]
            [case] # is now ST will advance to BC/skip SR (set in 08_ or 09_)
                value=Sand Trapper
                [message]
                    speaker=narrator
                    message= _ "Appraising the hardy soldiers around him, Jacques sees several better suited to lead this expedition. Yes, he has taken a blow here and there, but mostly he has stayed out of harm's way. If he is going to lead by example, now is the time to do so!"
                    image=wesnoth-icon.png
                [/message]
            [/case]
        [/switch]
        [message]
            speaker=narrator
            message= _ "Though his troops are ready to advance, Jacques waits to give the signal. He hopes Kyoko might decipher whatever help the Book of Prophecy may be able to give them. He is determined to give her as much time as possible."
            image=wesnoth-icon.png
        [/message]
        [message]
            speaker=narrator
            message= _ "Kyoko concentrates her mind and opens the book once more after several fruitless attempts. She is not drawn in or given insight, but finds yet another murky couplet, <i>Bridges burn when friendship ends. Old bones break before they knit.</i>"
            image=wesnoth-icon.png
        [/message]
        [message]
            speaker=Kyoko
            message= _ "I do not care about <big>bridges! <i>How do we defeat Ruphulus!</i></big> That is all I would know! <i>What fates may we impose on him?</i>"
        [/message]
        [message]
            speaker=narrator
            message= _ "As she speaks, the words change. The message now reads: <i>Arrows fly straight to their sighted target. Butterflies find hidden nectar.</i>"
            image=wesnoth-icon.png
        [/message]
        [message]
            speaker=Jacques
            message= _ "Any luck, Kyoko?"
        [/message]
        [message]
            speaker=Kyoko
            message= _ "No! It's so exasperating! The book may be telling me to cast about, or it may mean there's something plain before me I'm just not seeing. At any rate, I do not understand it. Perhaps this is not the time or place to consult the book."
        [/message]
        [message]
            speaker=Jacques
            message= _ "I fear nothing good lies ahead, but if there's comfort to be had from that book, I am confident you will find it!"
        [/message]
        [message]
            speaker=King Bombasan
            message= _ "Things are as they are. Perhaps the chance for miracles has past. We have no more time to waste: the enemy's force grows large."
        [/message]
        [message]
            speaker=Jacques
            message= _ "You are right. <big>Friends! Comrades! Onwards!</big> <small>And let us not recognize too many former friends among our foes!</small>"
        [/message]
    [/event]

    [event]
        name=post_advance
        first_time_only=no
        [filter]
            id=Jacques
        [/filter]
        [switch]
            variable=Jacques_type
            [case] # was T is now ST
                value=Thief
                {MODIFY_UNIT id=Jacques advances_to (Battle Commander)}
                [message]
                    speaker=narrator
                    message= _ "Finally, Jacques feels he has set foot on the road he desires to take! He may have a way to go, but all beginnings must have a chance to grow."
                    image=wesnoth-icon.png
                [/message]
            [/case]
            [case] # was ST is now BC
                value=Sand Trapper
                [message]
                    speaker=narrator
                    message= _ "Shadows no longer frighten Jacques. He is calm and determined. Nearby troops are reinvigorated and fight with new resolve. The darkness seems a little brighter. Jacques has become a true commander."
                    image=wesnoth-icon.png
                [/message]
            [/case]
        [/switch]
        {STORE_UNIT_VAR id=Jacques type Jacques_type}
    [/event]

    [event]
        name=turn 2
        [message]
            speaker=Loathing
            message= _ "Damn this sentry duty! I simply loathe staring down eerie corridors. What about thee, brother?"
        [/message]
        [message]
            speaker=Fear
            message= _ "I don't like it, nohow. I'm afraid of what might cometh along."
        [/message]
        [message]
            speaker=Loathing
            message= _ "Hey! Someone approaches! Heavens help me, if it's not those loathsome dwarves again!"
        [/message]
        [message]
            speaker=Fear
            message= _ "Don't frighten me like that! I'm sure it's just some travelers, lost their way, looking for a place to lay their weary bones."
        [/message]
        [message]
            speaker=Jacques
            message= _ "We will indeed be laying down some weary bones, but not ours. Get them!"
        [/message]
    [/event]

#define FEAR_DEAD
    [message]
        speaker=Loathing
        message= _ "You killed my brother!"
    [/message]
    [message]
        speaker=Loathing
        message= _ "If I could, I'd send you to an unfortunate fate to greet him again!"
    [/message]
#enddef

#define LOATHING_DEAD
    [message]
        speaker=Fear
        message= _ "Loathing, brother, where art thou? What have you done to him? Why are his bones so still?"
    [/message]
    [message]
        speaker=Fear
        message= _ "I suppose there's no way we could talk this through...?"
    [/message]
#enddef

#define FEAR_AND_LOATHING_DEAD
    [message]
        speaker=Jacques
        message= _ "Odd and pitiful creatures, the pair of them. I hope they find their rest beyond death and undeath... Now, onwards friends, onwards!"
    [/message]
#enddef

    [event]
        name=turn 3
        [switch]
            variable=Fear_and_Loathing
            [case] # both alive
                value=0
                [message]
                    speaker=Fear
                    message= _ "Loathing, brother, where art thou?"
                [/message]
                [message]
                    speaker=Loathing
                    message= _ "I'm here, brother, haveth no fear."
                [/message]
                [message]
                    speaker=Fear
                    message= _ "Do you think there's any chance these creatures will leave us be?"
                [/message]
                [message]
                    speaker=Loathing
                    message= _ "I shall hate it if they don't."
                [/message]
            [/case]
            # repeated dialog off-loaded to macros
            [case]
                value=1
                {FEAR_DEAD}
            [/case]
            [case]
                value=2
                {LOATHING_DEAD}
            [/case]
        [/switch]
    [/event]

    [event]
        name=turn 4
        [switch]
            variable=Fear_and_Loathing
            [case] # both alive
                value=0
                [message]
                    speaker=Fear
                    message= _ "-Are we still here, then?"
                [/message]
                [message]
                    speaker=Loathing
                    message= _ "My, they go about their business slowly, don't they?"
                [/message]
                [message]
                    speaker=Fear
                    message= _ "Fast enough, to my mind. I wish they'd all just go away."
                [/message]
                [message]
                    speaker=Loathing
                    message= _ "Perhaps that big stony fellow will help them speed things up."
                [/message]
            [/case]
            [case]
                value=1
                {FEAR_DEAD}
            [/case]
            [case]
                value=2
                {LOATHING_DEAD}
            [/case]
        [/switch]
    [/event]

    [event] # forbidden signpost
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x,y=18,24
        [/filter]
        [message]
            speaker=narrator
            message= _ "<big>Forbidden Entry!</big> By order of the Dragon Lord!"
            image=wesnoth-icon.png
        [/message]
    [/event]

    [event] # fight! signpost
        name=moveto
        [filter]
            side=1
            x,y=8,28
        [/filter]
        [message]
            speaker=narrator
            message= _ "Rule number 1 states: <big>Obey orders or die!</big> You didn't obey orders..."
            image=wesnoth-icon.png
        [/message]
        [unit]
            side=2
            type=Revenant
            x,y=8,29
            placement=map_passable
        [/unit]
        [unit]
            side=2
            type=Skeleton
            x,y=8,26
            placement=map_passable
        [/unit]
        [unit]
            side=2
            type=Skeleton Archer
            x,y=10,29
            placement=map_passable
        [/unit]
    [/event]

    [event] # Krug's signpost
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x,y=28,21
        [/filter]
        [message]
            speaker=narrator
            # intentionally misspelled; he's a troll, after all
            # it means Danger! Keep out!
            message= _ "<big>Dangher! Kip owt!</big>" # wmllint: no spellcheck
            image=wesnoth-icon.png
        [/message]
    [/event]

    [event] # Krug's bonestack
        name=moveto
        [filter]
            side=1
            x,y=30,12
        [/filter]
        [message]
            speaker=narrator
            message= _ "<big>Go Away!</big>"
            image=wesnoth-icon.png
        [/message]
    [/event]

    [event] # discover Krug
        name=moveto
        [filter]
            side=1
            x,y=29,10
        [/filter]
        {TELEPORT_TILE 29 10 28 10}
        [unit]
            side=1
            id=Krug
            name= _ "Krug"
            unrenamable=yes
            type=Great Troll
            profile=portraits/troll-Krug.png
            unrenamable=yes
            x,y=29,10
            placement=map_passable
        [/unit]
        [message]
            speaker=Krug
            # wmllint: local spelling bonehe
            message= _ "Haven't had enough yet bonehead? Krug can always enlarge bone stack at bottom of mountain. You bonehe- Hey! This one has some meat on bones- how can that be?"
        [/message]
        [message]
            x,y=28,10
            message= _ "Huh? We thought none but the cursed undead would be found down here. I gather you are not a minion of Ruphulus?"
        [/message]
        [message]
            speaker=Krug
            message= _ "Meat on bones talk like it does not care for stupid boneheads. Reminds Krug of crazy explorer. Hmmm... Who is this weakling?"
        [/message]
        [message]
            x,y=28,10
            message= _ "In the name of Kythonia we are here to defeat Ruphulus and his army, and to liberate these caves!"
        [/message]
        [message]
            speaker=Krug
            message= _ "Ha! Liberate, weakling says. Would they have caves liberate of Krug, as well?"
        [/message]
        [message]
            x,y=28,10
            message= _ "Only if you chose to attack Kythonia and invade those lands further up towards the surface."
        [/message]
        [message]
            speaker=Krug
            message= _ "Surface, ha! Surface for weaklings. Krug perfectly happy here, if only pesky bones not disturb."
        [/message]
        [message]
            x,y=28,10
            message= _ "Then it seems we may have common purpose; we don't like them either. Join us in our fight against them!"
        [/message]
        [message]
            speaker=Krug
            message= _ "Be rid of boneheads? Have peace and quiet once more? Yes, Krug would like, yes, so Krug join you now."
        [/message]
        [set_variable]
            name=Krug_met
            value=yes
        [/set_variable]
    [/event]

    [event] # pulverized bones
        name="moveto"
        [filter]
            side=1
            x=27,27,28,29,31,32,32
            y=9,11,11,8,11,9,10
        [/filter]
        [message]
            speaker=narrator
            message= _ "These bones have been so badly pulverized even the necromancer can't use them!"
            image=wesnoth-icon.png
        [/message]
    [/event]

    [event] # explorer's hut
        name=moveto
        [filter]
            side=1
            x,y=40,20
        [/filter]
        [message]
            speaker=narrator
            message= _ "The hut is empty, but it is not as barren as the others. Garments and strange equipment are strewn about that surely would not be used by Ruphulus or his minions. Who lives here?"
            image=wesnoth-icon.png
        [/message]
    [/event]

    [event] # explorer's corpse
        name=moveto
        [filter]
            side=1
            # original locations are listed below
            #x= 1,11,12,12,40
            #y=21, 2, 1, 2,18
            x=38,38,39,39,40
            y=17,18,17,18,18
        [/filter]
        [message]
            speaker=narrator
            message= _ "You stumble upon a recently dead body that is more than rattling bones, though not a pretty sight. Scattered around the site are various instruments and maps of the area."
            image=wesnoth-icon.png
        [/message]
        [message]
            speaker=Jacques
            message= _ "Perhaps this is the explorer mentioned by Krug?"
            [show_if]
                [variable]
                    name=Krug_met
                    equals=yes
                [/variable]
            [/show_if]
        [/message]
        [message]
            speaker=narrator
            message= _ "Consulting the maps, the layout of this part of the cave system becomes much clearer."
            image=wesnoth-icon.png
        [/message]
        [remove_shroud]
            side=1
            x,y=9-41,0-22
        [/remove_shroud]
    [/event]

    [event]
        name=sighted
        [filter]
            id=Counsellor of Death
        [/filter]
        [filter_second]
            side=1
        [/filter_second]
        [message]
            speaker=Counsellor of Death
            message= _ "I see we have some uninvited visitors, busybodies sticking their noses where they don't belong!"
        [/message]
        [message]
            speaker=Counsellor of Death
            message= _ "Busybodies, haha! I will indeed find good use for your bodies, once they lay sprawled beneath my feet!"
        [/message]
    [/event]

    [event] # mushroom patch
        name=moveto
        [filter]
            side=1
            x= 1, 1, 2, 2, 3, 3
            y=32,33,31,32,32,33
        [/filter]
        [message]
            speaker=narrator
            message= _ "The ground is littered with scraps of paper torn to little bits. You examine a few: <i>eyes like deepest</i>, <i>to you...ever be true</i>, <i>spirit soars</i>. It seems to be someone's bad poetry, discarded."
            image=wesnoth-icon.png
        [/message]
    [/event]

    [event] # evil altars
        name=moveto
        [filter]
            side=1
            x=1,7
            y=1,1
        [/filter]
        [message]
            speaker=narrator
            message= _ "The altar is smeared with bits of decaying flesh and putrefaction."
            image=wesnoth-icon.png
        [/message]
    [/event]

    [event] # K's garden
        name=moveto
        [filter]
            side=1
            x,y=1-16,34-40
        [/filter]
        [remove_shroud]
            side=1
            x,y=0-17,33-41
        [/remove_shroud]
        [message]
            speaker=unit
            message= _ "What a calm, peaceful place! I wonder why it is here?"
        [/message]
    [/event]

    [event] # K's garden
        name=moveto
        [filter]
            id=Kyoko
            x,y=1-16,34-40
        [/filter]
        [message]
            speaker=Kyoko
            message= _ "Yes, I think I was right to come here to consult the book. Now, to find the proper place..."
        [/message]
    [/event]

    [event] # K's tree
        name=moveto
        [filter]
            id=Kyoko
            x,y=7,37
        [/filter]
        [message]
            speaker=Kyoko
            message= _ "A little island with an oak! Ha! I think I found the proper place. It's so calm ... so soothing. Why would that monster Ruphulus create a place like this?"
        [/message]
        [message]
            speaker=narrator
            message= _ "Sitting on the island propped against the tree Kyoko has a perfect view of fields of flowers. She wishes she could stay forever. It is a place which suits her precisely. She has an eerie feeling she knows why. She opens the Book of Prophecy. This time her head fills with images."
            image=wesnoth-icon.png
        [/message]
        [message]
            speaker=narrator
            message= _ "First, she sees herself singing a song during the celebrations of her father's past birthday. Ruphulus watches her, a gleam in his eye. She easily perceives she is an object of his lust... perhaps also of genuine affection."
            image=wesnoth-icon.png
        [/message]
        [message]
            speaker=narrator
            message= _ "The scene shifts and Kyoko sees herself collapse to the floor. She sees Ruphulus gently carry her a short way then transform into a dragon. It was his own wings she heard flap that night! But he never drops her. After a time of flying, the dragon begins to circle, then swoops down and places Kyoko in a shrub in the path of a young approaching wose. He watches hidden, until the wose stumbles on her supine form, then flies off."
            image=wesnoth-icon.png
        [/message]
        [message] # in case K & R did not engage in 07_ message will be skipped
            speaker=narrator
            message= _ "Finally, she sees images from their past battle in the Grand Chamber. Lieutenant Popper falls again and Ruphulus again transforms into a dragon before their eyes. Mighty is his rage, but not towards Kyoko, whom he did his utmost to spare."
            image=wesnoth-icon.png
            [show_if]
                [variable]
                    name=Kyoko_safe
                    equals=1
                [/variable]
            [/show_if]
        [/message]
        [message]
            speaker=narrator
            message= _ "Kyoko ponders these images from the past. The evil mage loves her! That is why he could not finally harm her, why he accosted her, why he risked his plans like a fool. Suddenly, irrationally, she knows this very place: he has created it for her, a haven for her to relax in and enjoy."
            image=wesnoth-icon.png
        [/message]
        [message]
            speaker=narrator
            message= _ "The book shows another image: she walks across a once broken bridge, toward the fearsome dragon. She feels neither fear nor anger: does not wield her staff in combat. She is smiling, and she opens her arms for an embrace. The bewildered dragon looks at her with hopeful eyes."
            image=wesnoth-icon.png
        [/message]
        [message]
            speaker=narrator
            message= _ "Kyoko is likewise bewildered by what she sees. And then it becomes clear to her. <i>Life is not fair</i>, Luxor said. She has come to realize this is a truth that <b>cuts many ways</b>. Finally, she knows what she has to do."
            image=wesnoth-icon.png
        [/message]
        [set_variable]
            name=Kyoko_knows
            value=yes
        [/set_variable]
    [/event]

    [event] # K enters R's lair (not garden)
        name=moveto
        first_time_only=no
        [filter]
            id=Kyoko
            x,y=1-7,6-11
        [/filter]
        [if]
            [variable]
                name=Kyoko_knows
                equals=yes
            [/variable]
            [then]
                [if]
                    [variable]
                        name=bridges_built
                        equals=3
                    [/variable]
                    [then]
                        [remove_shroud]
                            side=1
                            x,y=1-7,1-10
                        [/remove_shroud]
                        [message]
                            speaker=narrator
                            message= _ "As Kyoko steps into the chamber of the Dragon, she yells out for everyone to stop fighting. In bewilderment, those who hear her command obey."
                            image=wesnoth-icon.png
                        [/message]
                        [message]
                            speaker=Kyoko
                            message= _ "I need to speak to Ruphulus. Alone."
                        [/message]
                        [message]
                            speaker=Jacques
                            message= _ "No, Kyoko! There is no need! We can beat the Dragon!"
                        [/message]
                        [message]
                            speaker=narrator
                            message= _ "Jacques has no idea what's on Kyoko's mind, but he knows he doesn't like the idea of her getting too close to Ruphulus."
                            image=wesnoth-icon.png
                        [/message]
                        [message]
                            speaker=Kyoko
                            message= _ "Shush, brute! What needs to be done needs to be done. Besides, it is not only need. I desire it."
                        [/message]
                        {TELEPORT_TILE 4 9 4 15}
                        {TELEPORT_TILE 4 8 4 16}
                        {MOVE_UNIT id=Kyoko 4 9}
                        [message]
                            speaker=narrator
                            message= _ "Jacques is stunned. What strange path has the Book of Prophecy set her upon? He is caught flat-footed as she advances, unable to think or move fast enough to try stop her."
                            image=wesnoth-icon.png
                        [/message]
                        {TELEPORT_TILE 4 7 4 17}
                        {MOVE_UNIT id=Kyoko 4 8}
                        [message]
                            speaker="Jacques"
                            message= _ "<big><i>Nooo...!</i></big>"
                        [/message]
                        [music]
                            name="elvish-theme.ogg"
                            immediate="yes"
                        [/music]
                        {TELEPORT_TILE 4 6 4 18}
                        {MOVE_UNIT id=Kyoko 4 6}
                        [message]
                            speaker=narrator
                            message= _ "The Dragon is just as perplexed at Kyoko's approach. He follows her with an uncertain gaze as she makes her way toward him, smiling reassuringly."
                            image=wesnoth-icon.png
                        [/message]
                        {TELEPORT_TILE 4 5 4 19}
                        {MOVE_UNIT id=Kyoko 4 5}
                        [message]
                            speaker=Kyoko
                            message= _ "It is beautiful...! The little haven you built for me, it is truly beautiful!"
                        [/message]
                        [message]
                            speaker=Ruphulus
                            message= _ "It is?"
                        [/message]
                        [message]
                            speaker=narrator
                            message= _ "The Dragon wavers, unsure what to think."
                            image=wesnoth-icon.png
                        [/message]
                        [message]
                            speaker=Kyoko
                            message= _ "Yes! Yes it is! I never thought you had such beauty in you! Why did you not show it to me earlier?"
                        [/message]
                        [message]
                            speaker=Ruphulus
                            message= _ "I... I... wanted to, but I never really had the chance. When it was done I tried to invite you to see it, but you turned me down, remember? (<i>Snarl</i>) It still hurts when I think of that moment."
                        [/message]
                        [message]
                            speaker=Kyoko
                            message= _ "Of course I remember. I did not like being accosted like that. Had I known your feelings I might have behaved differently."
                        [/message]
                        {TELEPORT_TILE 4 4 4 20}
                        {MOVE_UNIT id=Kyoko 4 4}
                        [message]
                            speaker=narrator
                            message= _ "As she speaks, Kyoko approaches the Dragon who is becoming visibly agitated."
                            image=wesnoth-icon.png
                        [/message]
                        [message]
                            speaker=Kyoko
                            message= _ "I am so sorry everything turned out wrong. Oh, Ruphulus, have I driven you to become a beast? Can you never be the same old Ruphulus again? I would so much like to apologize to the man I once knew."
                        [/message]
                        [message]
                            speaker=Ruphulus
                            message= _ "Wait, my dear Kyoko. This is but one impenetrable shell I use. I am still the old Ruphulus inside. Here he is, as eager to talk to you as you are to him."
                        [/message]
                        [sound]
                            name=lightning.ogg
                        [/sound]
                        {FLASH_WHITE ()}
                        {TRANSFORM_UNIT id=Ruphulus (Arch Mage)}
                        {FULL_HEAL (id=Ruphulus)}
                        [message]
                            speaker=narrator
                            message= _ "With a flash, the dragon transforms into the old mage in his human form once more. Mighty though he is, his chin and hands shake as he looks at Kyoko."
                            image=wesnoth-icon.png
                        [/message]
                        [message]
                            speaker=Kyoko
                            message= _ "Oh, Ruphulus, it is so nice to see you again. What horrors have swept me up! You would never know. Can you help, can you make it stop?"
                        [/message]
                        [message]
                            speaker=narrator
                            message= _ "With these words, Kyoko throws herself at Ruphulus and flings her arms around him in embrace. The old mage is at a loss for words as he tries to console her."
                            image=wesnoth-icon.png
                        [/message]
                        [message]
                            speaker=Ruphulus
                            # wmllint: local spelling advers
                            message= _ "What do you mean, help? I can make your life wonderful: make you the queen of the world! As soon as we defeat our advers-"
                            image=portraits/Ruphulus.png
                        [/message]
                        [message]
                            speaker=narrator
                            message= _ "As the old mage speaks - a tremor in his heart and mind - an imperceptible movement of Kyoko's hand - the sudden flash of steel - a hilt protruding from his neck.... Ruphulus looks at Kyoko with puzzled eyes."
                            image=wesnoth-icon.png
                        [/message]
                        [message]
                            speaker=Ruphulus
                            # wmllint: local spelling wha lov
                            message= _ "-Wha...at? (<i>Gurgle</i>). Oh, I... (<i>He feels faint</i>) It's... cold... I... I lov- (<i>Kyoko jerks the blade across his throat; blood gushes and air hisses hauntingly from his slashed windpipe</i>)."
                            image=portraits/Ruphulus.png
                        [/message]
                        [kill]
                            id=Ruphulus
                            animate=yes
                        [/kill]
                        [message]
                            speaker=narrator
                            message= _ "The old mage crumples. Kyoko looks on in shocked detachment. The blade clatters from her limp hand. He was an evil man who brought destruction upon her world. Yet, she is saddened by what she has done. There is no bolt, no dragon resurrection. The sorcerer's minions already slink away in defeat. It doesn't take long for Jacques and his troops to secure the caves. The undead menace is no more."
                            image=wesnoth-icon.png
                        [/message]
                        [kill]
                            id=Krug,King Bombasan
                        [/kill]
                        [endlevel]
                            result=victory
                            bonus=yes
                            {NEW_GOLD_CARRYOVER 10}
                        [/endlevel]
                    [/then]
                    [else] # bridge not built
                        [message]
                            speaker=Kyoko
                            message= _ "I know what I need to do, but I need a clear path to Ruphulus to do it."
                        [/message]
                    [/else]
                [/if]
            [/then]
            [else] # bridge built but K doesn't know R's feelings
                [message]
                    speaker=Kyoko
                    message= _ "Somehow I must bring this to an end, but how?"
                [/message]
            [/else]
        [/if]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Fear
        [/filter]
        [message]
            speaker=Fear
            message= _ "What... what is this strange feeling? Suddenly, I... I feel no fear..."
        [/message]
        [set_variable]
            name=Fear_and_Loathing
            add=1
        [/set_variable]
        [if]
            [variable]
                name=Fear_and_Loathing
                equals=3
            [/variable]
            [then]
                {FEAR_AND_LOATHING_DEAD}
            [/then]
        [/if]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Loathing
        [/filter]
        [message]
            speaker=Loathing

            message= _ "Have I been killed... yet again? Oh, do not fret. I loathe you no longer. Finally, I'm free..."
        [/message]
        [set_variable]
            name=Fear_and_Loathing
            add=2
        [/set_variable]
        [if]
            [variable]
                name=Fear_and_Loathing
                equals=3
            [/variable]
            [then]
                {FEAR_AND_LOATHING_DEAD}
            [/then]
        [/if]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Bone Marshall
        [/filter]
        [message]
            speaker=Bone Marshall
            message= _ "Damn you fools! I have let my king down, and the way before you is opened. But be warned, there are adversaries much stronger than me you in your path, and you shall not succeed!"
        [/message]
        {SCROLL_TO 4 9}
        [delay]
            time=1000
        [/delay]
        [remove_shroud]
            side=1
            x,y=3-5,8-10
        [/remove_shroud]
        [delay]
            time=500
        [/delay]
        {MODIFY_TERRAIN Qxu^Bs| 4 9}
        [set_variable]
            name=bridges_built
            add=1
        [/set_variable]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Pet of Death
        [/filter]
        [message]
            speaker=Pet of Death
            message= _ "Arghh, I failed! Another stone is added to the bridge you must cross. But still, you won't succeed!"
        [/message]
        {SCROLL_TO 4 7}
        [delay]
            time=1000
        [/delay]
        [remove_shroud]
            side=1
            x,y=3-5,6-8
        [/remove_shroud]
        [delay]
            time=500
        [/delay]
        {MODIFY_TERRAIN Qxu^Bs| 4 7}
        [set_variable]
            name=bridges_built
            add=1
        [/set_variable]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Counsellor of Death
        [/filter]
        [message]
            speaker=Counsellor of Death
            message= _ "Hahahaha, you have defeated me and moved one step closer to the Dragon Lord, but so much the worse for you, for who wants to feel the wrath of Death itself?"
        [/message]
        {SCROLL_TO 4 5}
        [delay]
            time=1000
        [/delay]
        [remove_shroud]
            side=1
            x,y=3-5,5-6
        [/remove_shroud]
        [delay]
            time=500
        [/delay]
        {MODIFY_TERRAIN Qxu^Bs| 4 5}
        [set_variable]
            name="bridges_built"
            add=1
        [/set_variable]
    [/event]

    [event]
        name=last breath
        first_time_only=no
        [filter]
            id=Ruphulus
        [/filter]
        [message]
            id=Ruphulus
            message= _ "Hahaha! Your tiny knives and arrows can't harm me!"
            image="portraits/dragon_body.png"
        [/message]
        [message]
            speaker=narrator
            message= _ "Just when they think they have defeated the Dragon, he rises again, fully healed."
            image=wesnoth-icon.png
        [/message]
        {FULL_HEAL (id=Ruphulus)}
    [/event]

    {KYOKO_DEATH}
    [event]
        name=die
        [filter]
            id=Jacques
        [/filter]
        [message]
            speaker=narrator
            message= _ "Jacques believes he should lead by example and plunges into the thick of the struggle. But he gets too far ahead to benefit from the defense of his troops, and sudden fatigue overwhelms him. He stands as long as he can, but the swarm of undead quickly overcome him."
            image=wesnoth-icon.png
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=die
        [filter]
            id=King Bombasan
        [/filter]
        [message]
            speaker=narrator
            message= _ "The King fights like a young lion. His runic hammer is music to his soldiers' ears as it cracks undead skulls, and each strike sends another message of light and hope as it shatters their brittle bones. Still, the King is not young, and his powers ebb away. He fights on, ever weaker, until a blow crashes through his weakened arms and staves in his head. The King is no more."
            image=wesnoth-icon.png
        [/message]
        [message]
            speaker=narrator
            message= _ "The soldiers nearest Bombasan cry out and retaliate in fury. Still, the King's banner falls and soon all know his fate. Jacques leads them on and in tribute to their valiant King they fight with renewed vigor and intensity."
            image=wesnoth-icon.png
        [/message]
        [set_variable]
            name=Bombasan_dead
            add=1
        [/set_variable]
    [/event]

    [event]
        name=victory
        {CLEAR_VARIABLE Fear_and_Loathing}
        {CLEAR_VARIABLE bridges_built}
        {CLEAR_VARIABLE Kyoko_knows}
        {CLEAR_VARIABLE Kyoko_safe}
        {CLEAR_VARIABLE Krug_met}
    [/event]
[/scenario]
#undef FEAR_DEAD
#undef LOATHING_DEAD
#undef FEAR_AND_LOATHING_DEAD
